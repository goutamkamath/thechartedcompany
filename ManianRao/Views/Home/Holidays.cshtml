<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
    <meta name="author" content="AdminKit">
    <meta name="keywords" content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

    <link rel="shortcut icon" href="~/Content/Images/icons/icon-48x48.png" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="~/Plugins/fontawesome-free/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    @*<link rel="stylesheet" href="~/Plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
        <link rel="stylesheet" href="~/Plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
        <link rel="stylesheet" href="~/Plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
        <link rel="stylesheet" href="~/Plugins/datatables-fixedheader/css/fixedHeader.bootstrap4.min.css">
        <link rel="stylesheet" href="~/Plugins/datatables-select/css/select.bootstrap4.min.css">
        <link rel="stylesheet" href="~/Adminlte/dist/css/datatable_alphabetsearch.css">*@

    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">

    <title>The Charted Company</title>

    <link href="~/Content/CSS/app.css" rel="stylesheet">
    <script src="https://momentjs.com/downloads/moment.js"></script>
</head>

<body>
    <div class="wrapper">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-content js-simplebar">
                <a class="sidebar-brand" href="index.html">
                    <span class="align-middle">MANIAN & RAO</span>
                    <label style="font-size: 12px">Chartered Accountants</label>
                </a>

                <ul class="sidebar-nav">
                    <li class="sidebar-header">
                        Pages
                    </li>


                    <li class="sidebar-item ">
                        <a class="sidebar-link" href="Payroll">
                            <i class="align-middle" data-feather="dollar-sign"></i> <span class="align-middle">Payroll Management</span>
                        </a>
                    </li>
                    <li class="sidebar-item ">
                        <a class="sidebar-link" href="LeaveManagement">
                            <i class="align-middle" data-feather="calendar"></i> <span class="align-middle">Leave Management</span>
                        </a>
                    </li>


                </ul>


            </div>
        </nav>

        <div class="main">
            <nav class="navbar navbar-expand navbar-light navbar-bg">
                <a class="sidebar-toggle d-flex">
                    <i class="hamburger align-self-center"></i>
                </a>

                <form class="d-none d-sm-inline-block">
                    <div class="input-group input-group-navbar">
                        
                    </div>
                </form>

                <div class="navbar-collapse collapse">
                    <ul class="navbar-nav navbar-align">
                        <li class="nav-item dropdown">
                           
                        </li>
                        <li class="nav-item dropdown">
                           
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-icon dropdown-toggle d-inline-block d-sm-none" href="#" data-toggle="dropdown">
                                <i class="align-middle" data-feather="settings"></i>
                            </a>

                            <a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#" data-toggle="dropdown">
                                <img src="~/Content/Images/avatars/avatar-3.jpg" class="avatar img-fluid rounded mr-1" alt="Charles Hall" /> <span class="text-dark">HR Login</span>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right">

                                <a class="dropdown-item" href="AddEmployee"><i class="align-middle mr-1" data-feather="users"></i> Manage Employees</a>
                                <a class="dropdown-item" href="Holidays"><i class="align-middle mr-1" data-feather="clock"></i> Manage Holidays</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="Setting"><i class="align-middle mr-1" data-feather="settings"></i> Settings</a>
                                <a class="dropdown-item" href="Help"><i class="align-middle mr-1" data-feather="help-circle"></i> Help Center</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#">Log out</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>

            <main class="content" style="background-image: url('/Content/Images/holiday.jpg')">
                <div class="container-fluid p-0">

                    <div class="row mb-2 mb-xl-3">
                        <div class="col-auto d-none d-sm-block">
                            <h3><b>Holidays</b></h3>
                        </div>

                        <!-- <div class="col-auto ml-auto text-right mt-n1">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb bg-transparent p-0 mt-1 mb-0">
                        <li class="breadcrumb-item"><a href="#">AdminKit</a></li>
                        <li class="breadcrumb-item"><a href="#">Dashboards</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Analytics</li>
                    </ol>
                </nav>
            </div> -->
                    </div>
                    <div class="card" style="box-shadow: 2px 2px 2px 2px #D9D9D9">

                        <div class="card-body">
                            <div class="input_fields_wrap">

                                <div>Holiday On &nbsp;&nbsp;&nbsp;<input type="date" name="holidays" id="D0"></div>
                                <div>Holiday For&nbsp;&nbsp;&nbsp;<input type="text" name="holidays" id="T0"></div></br></br>

                            </div>
                            <button class="add_field_button">Add a Holiday</button>
                            </br> </br>
                            <div class="row">

                                <div>

                                    <label onclick="AddHolidays()" class="float-left btn btn-primary">Save Holidays</label>
                                </div>
                            </div>
                        </div>

                    </div>






                </div>

               

                <div class="row">
                    <div class="col-12 col-lg-12 col-xxl-12 d-flex">
                        <div class="card flex-fill">
                            <div class="card-header">

                                <h5 id="holidayyear" class="card-title mb-0">Holiday List</h5>
                            </div>
                            <table id="HolidayTable" class="table table-hover my-0" style="box-shadow: 2px 2px 2px 2px #D9D9D9">
                                <thead class="bg-gray-light">
                                    <tr class="text-gray-dark">
                                        
                                        <th class="d-none d-xl-table-cell">Action</th>
                                        <th class="d-none d-xl-table-cell">Holiday On</th>
                                        <th class="d-none d-xl-table-cell">Holiday For</th>



                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th class="d-none d-xl-table-cell" style="display:none !important">Action</th>
                                        <th class="d-none d-xl-table-cell" style="display:none !important">Holiday On</th>
                                        <th class="d-none d-xl-table-cell" style="display:none !important">Holiday For</th>
                                        


                                    </tr>
                                </tfoot>

                            </table>

                        </div>
                    </div>
                    <!-- <div class="col-12 col-lg-4 col-xxl-3 d-flex">
            <div class="card flex-fill w-100">
                <div class="card-header">

                    <h5 class="card-title mb-0">Monthly Sales</h5>
                </div>
                <div class="card-body d-flex w-100">
                    <div class="align-self-center chart chart-lg">
                        <canvas id="chartjs-dashboard-bar"></canvas>
                    </div>
                </div>
            </div>
        </div> -->
                </div>
                <div class="modal fade" id="DescModal" role="dialog">
                    <div class="modal-dialog">
                        <div class="modal-content" style="width:148%;left:-17%;margin-top:23% !important">
                            <div class="modal-header">

                                <h3 class="modal-title" id="headerForBranchName">Holiday Details</h3>

                            </div>
                            <div class="modal-body">
                                <h5 class="text-center"></h5>
                                <form role="form" id="editingPayrollForm" novalidate="novalidate">
                                    <div class="row">



                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="editingHolidayOn">Holiday On*</label>
                                                <input type="date" name="editingHolidayOn" class="form-control is-invalid" id="editingHolidayOn"
                                                       placeholder="Select Date" aria-describedby="editingexampleInputRole-error"
                                                       autocomplete="off" required />

                                            </div>
                                        </div>




                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="editingHolidayFor">Holiday For*</label>
                                                <input type="text" name="editingHolidayFor" class="form-control is-invalid" id="editingHolidayFor"
                                                       placeholder="Holiday was for" aria-describedby="editingexampleInputRole-error"
                                                       autocomplete="off" required />

                                            </div>
                                        </div>

                                      



                                    </div>
                                    </br> </br>
                                    <div class="row">




                                    </div>
                                    </br>
                                    <div>

                                        <label onclick="AddHolidays('editing')" class="float-left btn btn-primary">Save</label>
                                    </div>
                                </form>
                            </div>

                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
            </main>



            <footer class="footer">
                <div class="container-fluid">
                    <div class="row text-muted">
                        <div class="col-6 text-left">
                            <p class="mb-0">
                                <a href="../Home/Payroll" class="text-muted"><strong>MyChartedCompany</strong></a> &copy;
                            </p>
                        </div>
                        <div class="col-6 text-right">
                            <ul class="list-inline">
                                <li class="list-inline-item">
                                    <a class="text-muted" href="Help">Support</a>
                                </li>
                                <li class="list-inline-item">
                                    <a class="text-muted" href="Help">Help Center</a>
                                </li>
                                <li class="list-inline-item">
                                    <a class="text-muted" href="#">Privacy</a>
                                </li>
                                <li class="list-inline-item">
                                    <a class="text-muted" href="#">Terms</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
   
    <script src="~/Scripts/app.js"></script>

  
       


      

</body>

</html>


<script>


    function AddHolidays(param) {
        param === undefined ? param = "" : param;
        var URL = '';
        if (param == 'editing') {
            URL = "../Home/EditHoliday";
           
            
            var model = {};
            model.Id = window.holId;
            model.HolidayOn = document.getElementById('editingHolidayOn').value;
            model.HolidayFor = document.getElementById('editingHolidayFor').value;
              


            $.ajax({
                url: URL, // endpoint
                type: "POST",

                data: JSON.stringify(model),

                contentType: "application/json; charset=utf-8",
                success: function (result) {

                    if (result) {

                        window.location.reload();
                    }
                    // success
                },
                error: function (errorData) { alert(errorData) }
            });
        }
        else {
            URL = "../Home/AddHolidays";
            var arr = [];
            var domele = [];
            domele = document.getElementsByName("holidays");


            for (var i = 0; i < domele.length; i++) {
                var model = {};
                model.HolidayOn = domele[i].value;
                model.HolidayFor = domele[i + 1].value;
                i = i + 1;
                arr.push(model);
            }



            $.ajax({
                url: URL, // endpoint
                type: "POST",

                data: JSON.stringify(arr),

                contentType: "application/json; charset=utf-8",
                success: function (result) {

                    if (result) {

                        window.location.reload();
                    }
                    // success
                },
                error: function (errorData) { alert(errorData) }
            });
        }


    }



    function validateIsRequiredFields(param) {
        param === undefined ? param = "" : param;
        // var elem = document.getElementsByTagName('input');
        var elem = document.forms[param + "PayrollForm"].elements;
        for (i = 0; i < elem.length; i++) {
            if (elem[i].hasAttribute('required')) {
                if (elem[i].getAttribute('type') == 'checkbox') {
                    if (elem[i].checked) {
                        elem[i].classList.remove("is-invalid");
                        elem[i].classList.add("is-valid");
                    }
                    else {
                        elem[i].classList.remove("is-valid");
                        elem[i].classList.add("is-invalid");
                    }

                }

                else {

                    if (elem[i].value.length == 0 || elem[i].value == "DEF" || elem[i].value == "0") {
                        elem[i].classList.remove("is-valid");
                        elem[i].classList.add("is-invalid");

                    }
                    else {
                        elem[i].classList.remove("is-invalid");
                        elem[i].classList.add("is-valid");

                    }

                }
            }
        }
    }

    $(document).ready(function () {
        const d = new Date();
        let year = d.getFullYear();
        //document.getElementById("holidayyear").innerHTML = document.getElementById("holidayyear").innerHTML +" - "+year;

        var max_fields = 10; //maximum input boxes allowed
        var wrapper = $(".input_fields_wrap"); //Fields wrapper
        var add_button = $(".add_field_button"); //Add button ID

        var x = 1; //initlal text box count
        $(add_button).click(function (e) { //on add input button click
            e.preventDefault();
           
                x++; //text box increment
            $(wrapper).append('<div>Holiday On &nbsp;&nbsp;&nbsp;<input type="date" name="holidays" id="D' + x +'"/></div><div>Holiday For&nbsp;&nbsp;&nbsp;<input type="text" name="holidays" id="T'+ x +'"></div><a href="#" class="remove_field">Remove</a></div></br></br>'); //add input box
            
        });

        $(wrapper).on("click", ".remove_field", function (e) { //user click on remove text
            e.preventDefault(); $(this).parent('div').remove(); x--;
        })


        $.ajax({
            url: '../Home/GetHolidayList',
            method: 'Get',
            //data: { ddlid: '01' },          // this is input parameter for your function
            dataType: 'json',
            contentType: 'text/json',
            success: function (res) {

                var data = [];
                for (var i = 0; i < res.length; i++) {
                   
                    data.push(['<i onclick=funtnEditHoliday(' + res[i]["Id"] + ') class="fa fa-pen faa-wrench">    Edit</i>&nbsp;&nbsp;&nbsp;<i onclick=funtnDeleteHoliday(' + res[i]["Id"] + ') class="fa fa-trash faa-wrench">    Delete</i>', new Date(res[i]["HolidayOn"]).toUTCString().split('0:')[0].slice(0, -2), res[i]["HolidayFor"]]);
                }

                //End Test Data

                t = $("#HolidayTable").DataTable({

                    "dom": "<'row'<'col-md-6'B><'col-md-1'r><'col-md-3'f><'col-md-1'l>A>" +
                        "<'row'<'col-md-12't>><'row'<'col-md-6'i><'col-md-6'p>>",

                    "data": data,

                    //"alphabetSearch": {
                    //    "column": 2
                    //},

                    "select": {
                        "style": 'multi',
                        "selector": 'td:first-child'
                    },

                    "paging": true,
                    "deferRender": true,
                    "responsive": true,
                    'info': true,
                    "lengthMenu": [
                        [10, 25, 50, 100, -1],
                        [10, 25, 50, 100, "All"]
                    ],
                    "autoWidth": false,
                    "order": [
                        [1, "asc"]
                    ],
                    "buttons": ['colvis', 'copy', 'csv', 'excel', 'pdf', 'print'],
                    "fixedHeader": {
                        "header": true,
                        //"footer": true,
                        "headerOffset": $('#nav-bar-id').innerHeight(),
                    },

                    initComplete: function () {
                        // Apply the search
                        this.api().columns().every(function () {
                            var that = this;

                            $('input', this.footer()).on('keyup change clear', function () {
                                if (that.search() !== this.value) {
                                    that
                                        .search(this.value)
                                        .draw();
                                }
                            });
                        });
                    }

                });

                // t.on('order.dt search.dt', function () {
                //     t.column(1, {
                //         search: 'applied',
                //         order: 'applied'
                //     }).nodes().each(function (cell, i) {
                //         cell.innerHTML = i + 1;
                //     });
                //
                // }).draw();


            }
        });
    });
    function funtnEditHoliday(data) {
        $('#DescModal').modal("show");


        $.ajax({
            cache: false,
            type: "Get",
            url: '../Home/GetHolidayList',
            data: { "ID": data, "subregParamYN": "N" },
            success: function (json) {
                window.holId = data;
               // $('#editingHolidayOn').val(new Date(json[0]["HolidayOn"]).toUTCString().split('18:')[0].trim(' '));
                $('#editingHolidayFor').val(json[0]["HolidayFor"]);
            
                $('#editingHolidayOn').val(moment(json[0]["HolidayOn"]).format('YYYY-MM-DD'));

            

                document.getElementById('editingHolidayOn').classList.remove("is-invalid");
                document.getElementById('editingHolidayOn').classList.add("is-valid");
                document.getElementById('editingHolidayFor').classList.remove("is-invalid");
                document.getElementById('editingHolidayFor').classList.add("is-valid");



            },
            error: function () {
                alert("Data Not Found");
            }
        });





    }
    function funtnDeleteHoliday(data) {
        $.ajax({
            cache: false,
            type: "Get",
            url: '../Home/DeleteHoliday',
            data: { "ID": data },
            success: function (json) {
              
                // $('#editingHolidayOn').val(new Date(json[0]["HolidayOn"]).toUTCString().split('18:')[0].trim(' '));
                $('#editingHolidayFor').val(json[0]["HolidayFor"]);

                $('#editingHolidayOn').val(moment(json[0]["HolidayOn"]).format('YYYY-MM-DD'));



                document.getElementById('editingHolidayOn').classList.remove("is-invalid");
                document.getElementById('editingHolidayOn').classList.add("is-valid");
                document.getElementById('editingHolidayFor').classList.remove("is-invalid");
                document.getElementById('editingHolidayFor').classList.add("is-valid");



            },
            error: function () {
                alert("Data Not Found");
            }
        });
    }
    </script>
